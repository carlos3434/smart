var Roles={all:function(){$.get("api/roles",function(o){}).done(function(o){}).fail(function(o){}).always(function(o){})},get:function(o){$.get("api/roles/"+o,function(o){vm.rol=o,modulosRol()}).done(function(o){}).fail(function(o){}).always(function(o){})},store:function(){vm.rol.submodulos=vm.submodulos,$.post("api/roles",vm.rol,function(o){reload(),$("#rolModal").modal("hide")}).done(function(o){}).fail(function(o){}).always(function(o){})},update:function(o){vm.rol.submodulos=vm.submodulos,$.put("api/roles/"+o,vm.rol,function(o){reload(),$("#rolModal").modal("hide")}).done(function(o){}).fail(function(o){}).always(function(o){})},destroy:function(o){$.delete("api/roles/"+o,function(o){user=o}).done(function(o){}).fail(function(o){}).always(function(o){})},allPaginate:function(o){$.post("api/roles/all-paginate",{name:"John",time:"2pm"},function(e){o(e)}).done(function(o){}).fail(function(o){}).always(function(o){})},CambiarEstadoAreas:function(o,e){}},Modulos={all:function(){$.get("modulos/lista",function(o){vm.modulos=o,modulos()}).done(function(o){}).fail(function(o){}).always(function(o){})}},Permisos={all:function(){$.get("permissions/lista",function(o){vm.permissions=o}).done(function(o){}).fail(function(o){}).always(function(o){})}},vm=new Vue({el:"#main",data:{rol:{},permissions:[],modulos:[],submodulos:[],accion:""},methods:{guardarRole:function(){"nuevo"==vm.accion?Roles.store():Roles.update(vm.rol.id)},storeRole:function(){$("#rolModal").modal(),vm.accion="nuevo",vm.rol={},$selectModulos.val([]).trigger("change")},modulos:function(){Modulos.all()},roles:function(){Roles.all()}}}),tabla="datatable_tabletools",responsiveHelper_datatable_tabletools=void 0,$selectModulos,breakpointDefinition={tablet:1024,phone:480},columnDefs=[{targets:0,data:"id",name:"id",searchable:!1},{targets:1,data:"nombre",name:"nombre"},{targets:2,data:"nombre_mostrar",name:"nombre_mostrar"},{targets:3,data:"descripcion",name:"descripcion",searchable:!1},{targets:4,name:"updated_at",searchable:!1,data:function(o,e,n,s){return'<td><button type="button" onClick="editar('+o.id+')" class="btn btn-primary">Editar</button></td>'},defaultContent:""},{targets:5,name:"deleted_at",searchable:!1,data:function(o,e,n,s){return estado='<button type="button"  onClick="activar('+o.id+')" class="btn btn-success">Inactivo</button>',null===o.deleted_at&&(estado='<button type="button" onClick="desactivar('+o.id+')" class="btn btn-success">Activo</button>'),estado},defaultContent:""}],dataTable={processing:!0,serverSide:!0,stateSave:!0,searching:!0,ordering:!0,stateLoadCallback:function(o){$("body").append('<div class="overlay"></div><div class="loading-img"></div>')},stateSaveCallback:function(o){$(".overlay,.loading-img").remove()},ajax:{url:"api/roles",type:"GET",data:function(o){o.per_page=o.length,o.page=(o.start+o.length)/o.length,o.filter=o.search.value}},columnDefs:columnDefs,sDom:"<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'T>r>t<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",oLanguage:{sSearch:'<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'},oTableTools:{aButtons:["copy","csv","xls",{sExtends:"pdf",sTitle:"SmartAdmin_PDF",sPdfMessage:"SmartAdmin PDF Export",sPdfSize:"letter"},{sExtends:"print",sMessage:"Generated by SmartAdmin <i>(press Esc to close)</i>"}],sSwfPath:"js/plugin/datatables/swf/copy_csv_xls_pdf.swf"},autoWidth:!0,preDrawCallback:function(){responsiveHelper_datatable_tabletools||(responsiveHelper_datatable_tabletools=new ResponsiveDatatablesHelper($("#"+tabla),breakpointDefinition))},rowCallback:function(o,e){responsiveHelper_datatable_tabletools.createExpandIcon(o)},drawCallback:function(o){responsiveHelper_datatable_tabletools.respond()}},datatable;$(document).ready(function(){pageSetUp(),Modulos.all(),Permisos.all(),datatable=$("#"+tabla).DataTable(dataTable)}),editar=function(o){vm.accion="editar",Roles.get(o),$("#rolModal").modal()},desactivar=function(o){reload()},activar=function(o){reload()},reload=function(){datatable.ajax.reload(null,!1)},modulosRol=function(){for(var o=[],e=vm.rol.permissions.length-1;e>=0;e--)o.push(vm.rol.permissions[e].submodulo_id);$selectModulos.val(o).trigger("change")},modulos=function(){$selectModulos=$("#modulos").select2({dropdownParent:$("#rolModal")}),$selectModulos.on("change",function(o){var e;vm.submodulos=[];var n=[];if($("#modulos").val())for(var s=vm.modulos.length-1;s>=0;s--){e=vm.modulos[s].children;for(var a=e.length-1;a>=0;a--)if($("#modulos").val().indexOf(e[a].id.toString())>=0){if(n=[],"nuevo"==vm.accion)for(var t=vm.permissions.length-1;t>=0;t--)vm.permissions[t].submodulo_id==e[a].id.toString()&&(permiso={id:vm.permissions[t].id,nombre:vm.permissions[t].nombre_mostrar,orden:vm.permissions[t].orden,estado:!1},n.push(permiso));else{for(var i=vm.rol.permissions.length-1;i>=0;i--)vm.rol.permissions[i].submodulo_id==e[a].id.toString()&&(permiso={id:vm.rol.permissions[i].id,nombre:vm.rol.permissions[i].nombre_mostrar,orden:vm.rol.permissions[i].orden,estado:!0},n.push(permiso));for(var t=vm.permissions.length-1;t>=0;t--)if(permissions=vm.permissions[t],vm.permissions[t].submodulo_id==e[a].id.toString()){for(flag=!1,i=vm.rol.permissions.length-1;i>=0;i--)vm.rol.permissions[i].id==vm.permissions[t].id&&(flag=!0);!1===flag&&(permiso={id:vm.permissions[t].id,nombre:vm.permissions[t].nombre_mostrar,orden:vm.permissions[t].orden,estado:!1},n.push(permiso))}}n.sort(function(o,e){return o.orden-e.orden}),vm.submodulos.push({id:e[a].id,nombre:e[a].nombre,permisos:n})}}})};